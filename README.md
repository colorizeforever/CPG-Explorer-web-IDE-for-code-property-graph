# CPG Explorer — Code Property Graph IDE

A web-based IDE for exploring and understanding Go codebases through their Code Property Graph (CPG). Built for the Prometheus ecosystem.

## Quick Start

```bash
docker compose up
```

Open **http://localhost:3000** in your browser.

The first run generates the CPG database (~10-30 minutes), subsequent runs start instantly. The database is persisted in a Docker volume.

## Architecture

```
┌─────────────┐     ┌──────────────┐     ┌───────────────────┐
│   React SPA  │────▶│  Go REST API  │────▶│  SQLite CPG DB    │
│  (port 3000) │     │  (port 8080)  │     │  (~900 MB)        │
│  Cytoscape.js│     │  net/http     │     │  555K nodes       │
│  Tailwind    │     │  go-sqlite3   │     │  1.5M edges       │
└─────────────┘     └──────────────┘     └───────────────────┘
```

### Services

| Service | Description |
|---|---|
| `generator` | Builds cpg-gen, clones Prometheus repos, generates the CPG database (runs once) |
| `backend` | Go HTTP API serving CPG data from SQLite |
| `frontend` | React SPA served via Nginx with API proxy |

## Features

### 1. Call Graph Explorer
Search any function → visualize its call relationships via BFS expansion. Configurable depth (1-5), direction (callers/callees/both), and layout (hierarchical/force-directed). Double-click a node to re-center the graph around it.

### 2. Package Architecture Map
Force-directed visualization of the package dependency graph (~170 packages, ~400 edges). Node size reflects complexity; click a package to see its functions and metrics.

### 3. Data Flow Slicer
Trace data flow forward (definitions → uses) or backward (uses → definitions) along DFG edges. Visualize the path from variable creation to consumption.

### 4. Dashboard
Overview statistics, complexity distribution charts, edge-type breakdown, and hotspot detection — the riskiest functions by combined complexity, fan-in, and finding count.

### 5. Source Browser
Browse source files by package with Go syntax highlighting. Navigate directly from graph nodes to the relevant source code.

## Analyzed Modules

| Module | Description |
|---|---|
| **prometheus** (primary) | Core Prometheus server |
| **client_golang** | Prometheus client library for Go |
| **prometheus-adapter** | Kubernetes custom metrics adapter |
| **alertmanager** | Alert routing and notification |

## Development

### Prerequisites
- Go 1.25+ (for cpg-gen only)
- Node.js 18+ (frontend)
- Docker & Docker Compose

### Local Development (without Docker)

```bash
# 1. Generate the database
git submodule update --init
go build -o cpg-gen .
./cpg-gen \
  -modules "./client_golang:github.com/prometheus/client_golang:client_golang,./prometheus-adapter:sigs.k8s.io/prometheus-adapter:adapter,./alertmanager:github.com/prometheus/alertmanager:alertmanager" \
  ./prometheus cpg.db

# 2. Start the backend
cd backend
DB_PATH=../cpg.db go run .

# 3. Start the frontend (in another terminal)
cd frontend
npm install
npm run dev
```

### API Endpoints

| Endpoint | Description |
|---|---|
| `GET /api/overview` | Dashboard statistics |
| `GET /api/distributions` | Chart data (complexity, edges, nodes) |
| `GET /api/packages` | List packages with metrics |
| `GET /api/packages/graph` | Package dependency graph |
| `GET /api/functions?search=&package=` | Search functions |
| `GET /api/functions/detail?id=` | Detailed function info |
| `GET /api/callgraph?id=&depth=&direction=` | Call graph BFS |
| `GET /api/dataflow?id=&depth=&direction=` | Data flow graph |
| `GET /api/source?file=` | Source file content |
| `GET /api/hotspots?limit=` | High-risk functions |
| `GET /api/search?q=` | Global symbol search |
| `GET /api/schema` | Self-documenting schema |

## Design Decisions

See [DECISIONS.md](DECISIONS.md) for a detailed write-up of technology choices, architecture decisions, and trade-offs.

## Tech Stack

- **Backend**: Go 1.24, `net/http`, `mattn/go-sqlite3`
- **Frontend**: React 18, TypeScript, Vite, Cytoscape.js, Tailwind CSS
- **Database**: SQLite (generated by cpg-gen)
- **Infrastructure**: Docker Compose, Nginx
